<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bianco Timer - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</title>
  <style>
    :root {
      --bg1: #0c0f12;
      --card: #151a1f;
      --accent: #00c853;
      --accent-2: #2196f3;
      --muted: #9ba5b1;
      --danger: #ef5350;
      --border: rgba(255,255,255,0.05);
      --shadow: 0 2px 6px rgba(0,0,0,0.3);
    }

    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 12px;
      font-family: "Cairo", "Segoe UI", sans-serif;
      color: #e9eef4;
      background: var(--bg1);
      direction: rtl;
    }

    .wrap { max-width: 1100px; margin: auto; }

    header {
      display: flex; justify-content: space-between; align-items: center;
      gap: 8px; flex-wrap: wrap; padding-bottom: 8px;
      border-bottom: 1px solid var(--border);
    }

    h1 { margin: 0; font-size: 20px; }
    .small { color: var(--muted); font-size: 13px; }

    .btn {
      background: var(--accent);
      border: none; color: #021018;
      padding: 10px 14px; border-radius: 10px;
      font-weight: 700; cursor: pointer;
      box-shadow: var(--shadow);
      transition: 0.2s;
    }
    .btn:hover { transform: scale(1.05); }

    .secondary {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--muted);
      padding: 8px 10px; border-radius: 8px;
      cursor: pointer; transition: 0.2s;
    }
    .secondary:hover { color: #fff; border-color: #888; }

    .summary {
      display: flex; flex-wrap: wrap;
      gap: 10px; margin-top: 12px;
    }

    .card {
      background: var(--card);
      padding: 10px;
      border-radius: 10px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      flex: 1;
      min-width: 110px;
      text-align: center;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));
      gap: 10px;
      margin-top: 16px;
    }

    .device {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      box-shadow: var(--shadow);
      display: flex; flex-direction: column;
      gap: 8px;
    }

    .device .title {
      display: flex; justify-content: space-between; align-items: center;
    }

    .dev-name { font-weight: 800; color: #fff; }
    .dev-sub { font-size: 12px; color: var(--muted); }

    .status {
      padding: 6px 8px; border-radius: 8px;
      font-weight: 700; font-size: 13px;
    }

    .open { background: #0e4225; color: #9ef7b2; }
    .idle { background: #11161b; color: var(--muted); }

    .controls { display: flex; gap: 6px; margin-top: auto; }
    .controls button {
      flex: 1; padding: 8px; border-radius: 8px; border: none;
      font-weight: 800; cursor: pointer;
    }

    .start { background: var(--accent); color: #000; }
    .add { background: var(--accent-2); color: #fff; }
    .end { background: var(--danger); color: #fff; }

    .sessions {
      margin-top: 18px; background: var(--card);
      padding: 10px; border-radius: 12px;
      border: 1px solid var(--border);
    }

    table {
      width: 100%; border-collapse: collapse; margin-top: 8px;
      font-size: 13px;
    }

    th, td {
      padding: 8px; text-align: center;
      border-bottom: 1px solid var(--border);
    }

    th { color: var(--muted); }

    footer {
      margin-top: 14px; text-align: center;
      color: var(--muted); font-size: 12px;
    }

    /* Ù…ÙˆØ¯Ø§Ù„Ø§Øª */
    .modal-back {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.6);
      display: flex; align-items: center; justify-content: center;
      visibility: hidden; opacity: 0; transition: 0.2s;
      z-index: 100;
    }

    .modal-back.active { visibility: visible; opacity: 1; }

    .modal {
      width: 340px; max-width: 94%;
      background: #10161c;
      padding: 14px;
      border-radius: 12px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
    }

    label { font-size: 13px; color: var(--muted); display: block; margin-top: 6px; }

    input, select {
      width: 100%; padding: 10px; margin-top: 4px;
      border-radius: 8px; border: 1px solid var(--border);
      background: #1b232c; color: #fff;
      font-size: 15px;
    }

    option { background: #1b232c; color: #fff; }

    input:focus, select:focus {
      outline: 1px solid var(--accent-2);
    }

    .center { text-align: center; }
    .row { display: flex; gap: 8px; flex-wrap: wrap; }
    .row .half { flex: 1; }

    @media (max-width: 600px) {
      h1 { font-size: 18px; }
      .device { padding: 10px; }
      .grid { grid-template-columns: 1fr; }
      .btn, .secondary { font-size: 14px; padding: 8px 10px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div>
        <h1>ğŸ® Bianco Timer</h1>
        <div class="small">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (Ù…Ø­Ù„ÙŠ + Firebase)</div>
      </div>
      <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap">
        <div id="userEmail" class="small"></div>
        <button class="btn" id="goAdmin">ØµÙØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù</button>
        <button class="secondary" id="logoutBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
      </div>
    </header>

    <section class="summary">
      <div class="card"><div class="small">ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®</div><div id="todayStr" style="font-weight:800;margin-top:6px"></div></div>
      <div class="card"><div class="small">Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø©</div><div id="openCount" style="font-weight:800;margin-top:6px">0</div></div>
      <div class="card"><div class="small">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙŠÙˆÙ…</div><div id="todayRevenue" style="font-weight:800;margin-top:6px">0 Ø¬</div></div>
    </section>

    <section class="grid" id="devicesGrid"></section>

    <section class="sessions">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>Ø¬Ù„Ø³Ø§Øª Ø§Ù„ÙŠÙˆÙ…</strong>
        <div class="small">ğŸ•“ ØªÙØ­Ø°Ù ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¨Ø¹Ø¯ 24 Ø³Ø§Ø¹Ø©</div>
      </div>
      <table id="completedTable">
        <thead><tr><th>Ø¬Ù‡Ø§Ø²</th><th>Ù…Ù†</th><th>Ø¥Ù„Ù‰</th><th>Ø§Ù„Ù…Ø¯Ø©</th><th>Ø§Ù„Ø·Ù„Ø¨Ø§Øª</th><th>Ø§Ù„Ø³Ø¹Ø±</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>

    <footer>Â© Bianco Timer | Ø§Ù„Ø¬Ù„Ø³Ø§Øª ØªÙØ­ÙØ¸ ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙˆØªÙØ²Ø§Ù…Ù† Ù…Ø¹ Firebase</footer>
  </div>

  <!-- Ù†ÙØ³ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Ø­Ø°Ù Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„ ÙˆØ¸ÙŠÙÙŠ -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBFI6W1mCbFsG8MfcGxWL0JonZtJ_7P6W0",
      authDomain: "bianco-playstation.firebaseapp.com",
      projectId: "bianco-playstation",
      storageBucket: "bianco-playstation.firebasestorage.app",
      messagingSenderId: "699813217029",
      appId: "1:699813217029:web:568e169371a2361358ad6c"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const RATES = { ping:{single:30,double:40}, ps4:{single:30,double:40}, ps5:{single:40,double:50} };
    const DEVICES = []; DEVICES.push({id:'ping',label:'Ping',type:'ping'}); for(let i=1;i<=6;i++) DEVICES.push({id:`ps${i}`,label:`PS4-${i}`,type:'ps4'}); for(let i=7;i<=15;i++) DEVICES.push({id:`ps${i}`,label:`PS5-${i}`,type:'ps5'});

    const STORAGE_KEY='biancoSessionsLocal', RESET_KEY='biancoResetTime';
    function getStorage(){ try{return JSON.parse(localStorage.getItem(STORAGE_KEY)||'{}')}catch(e){return{}} }
    function setStorage(o){ localStorage.setItem(STORAGE_KEY,JSON.stringify(o)) }
    function todayKey(){ return new Date().toLocaleDateString('ar-EG') }
    function checkReset(){ const last=localStorage.getItem(RESET_KEY), now=Date.now(); if(!last){ localStorage.setItem(RESET_KEY, now); return } const diff=(now-Number(last))/(1000*60*60); if(diff>=24){ localStorage.removeItem(STORAGE_KEY); localStorage.setItem(RESET_KEY, now); } }

    let openSessions = {}, completedSessionsToday = [];
    function initLocal(){ checkReset(); const s=getStorage(); const t=todayKey(); if(!s[t]) s[t]={open:{},completed:[]}; setStorage(s); openSessions = s[t].open||{}; completedSessionsToday = s[t].completed||[]; }
    function persistLocal(){ const s=getStorage(); s[todayKey()] = { open: openSessions, completed: completedSessionsToday }; setStorage(s); }

    const devicesGrid = document.getElementById('devicesGrid');
    const todayStr = document.getElementById('todayStr');
    const openCountEl = document.getElementById('openCount');
    const todayRevenueEl = document.getElementById('todayRevenue');
    const completedTbody = document.querySelector('#completedTable tbody');
    const userEmailSpan = document.getElementById('userEmail');
    const logoutBtn = document.getElementById('logoutBtn');
    const goAdminBtn = document.getElementById('goAdmin');

    function nowISO(){ return new Date().toISOString(); }
    function diffMinutes(startISO,endISO){ return Math.max(0, Math.floor((new Date(endISO)-new Date(startISO))/60000)); }
    function format12FromISO(iso){ const d=new Date(iso); if(isNaN(d)) return '-'; let h=d.getHours(), m=d.getMinutes(), suf=h>=12?'Ù…Ø³Ø§Ø¡Ù‹':'ØµØ¨Ø§Ø­Ù‹Ø§', hh=h%12||12; return `${hh}:${m.toString().padStart(2,'0')} ${suf}`; }
    function durationText(mins){ const h=Math.floor(mins/60), m=mins%60; return `${h} Ø³ ${m} Ø¯`; }

    function renderDevices(){ devicesGrid.innerHTML=''; DEVICES.forEach((dev,idx)=>{ const open=openSessions[dev.id]; const statusHtml=open?`<div class="status open">Ù…ÙØªÙˆØ­Ø©</div>`:`<div class="status idle">Ø®Ø§Ù„ÙŠ</div>`; const infoHtml=open?`<div class="small">${format12FromISO(open.startISO)}</div><div class="small">Ù†ÙˆØ¹: ${open.mode==='single'?'ÙØ±Ø¯ÙŠ':'Ø²ÙˆØ¬ÙŠ'}</div>`:`<div class="small">Ø§Ø¶ØºØ· Ø¨Ø¯Ø¡</div>`; const controlsHtml=open?`<button class="end" data-action="end" data-idx="${idx}">Ø¥Ù†Ù‡Ø§Ø¡</button><button class="add" data-action="add" data-idx="${idx}">â• Ø·Ù„Ø¨</button>`:`<button class="start" data-action="start" data-idx="${idx}">Ø¨Ø¯Ø¡</button>`; const wrapper=document.createElement('div'); wrapper.className='device'; wrapper.innerHTML=`<div class="title"><div><div class="dev-name">${dev.label}</div><div class="dev-sub">${RATES[dev.type].single}/${RATES[dev.type].double} Ø¬</div></div>${statusHtml}</div><div>${infoHtml}</div><div class="controls">${controlsHtml}</div>`; devicesGrid.appendChild(wrapper); }); updateSummary(); renderCompleted(); }

    function updateSummary(){ openCountEl.textContent=Object.keys(openSessions).length; let total=0; completedSessionsToday.forEach(s=> total += Number(s.price||0)); todayRevenueEl.textContent = `${Number(total.toFixed(2))} Ø¬`; }

    function renderCompleted(){ completedTbody.innerHTML=''; completedSessionsToday.slice().reverse().forEach(s=>{ const tr=document.createElement('tr'); const drinksTxt = (s.drinks && s.drinks.length) ? s.drinks.map(d=>`${d.name}Ã—${d.qty}`).join(', ') : '-'; tr.innerHTML = `<td>${s.deviceLabel}</td><td>${format12FromISO(s.startISO)}</td><td>${format12FromISO(s.endISO)}</td><td>${s.duration}</td><td>${drinksTxt}</td><td>${s.price} Ø¬</td>`; completedTbody.appendChild(tr); }); }

    logoutBtn.addEventListener('click', async ()=> { try{ await signOut(auth); alert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬'); window.location.href='login.html'; }catch(e){ alert('Ø®Ø·Ø£ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬'); } });
    goAdminBtn.addEventListener('click', ()=> window.location.href='admin.html');

    onAuthStateChanged(auth, user => { if(user) userEmailSpan.textContent = user.email; });

    (function init(){ todayStr.textContent = new Date().toLocaleDateString('ar-EG'); initLocal(); renderDevices(); })();
  </script>
</body>
</html>
